<script>
var tabuladorVigente=[
        {"clave":"d32","descripcion":"TC medio superior","sm":16807.18},
        {"clave":"d08","descripcion":"TC asociado","sm":16122.02},
        {"clave":"d09","descripcion":"TC asociado B","sm":18080.27},
        {"clave":"d33","descripcion":"TC asociado C","sm":21122.96},
        {"clave":"d34","descripcion":"TC titular A","sm":24411.88},
        {"clave":"d35","descripcion":"TC titular B","sm":28896.31},
        {"clave":"d36","descripcion":"TC titular C","sm":33878.04},
        {"clave":"D37","descripcion":"HSM NMSA","sm":249.03},
        {"clave":"d38","descripcion":"HSM NMSB","sm":285.99},
        {"clave":"d39","descripcion":"HSM NMSC","sm":329.36},
        {"clave":"d40","descripcion":"HSM NSA","sm":412.02},
        {"clave":"d41","descripcion":"HSM NSB","sm":468.56},
        {"clave":"d42","descripcion":"HSM NSC","sm":498.47},
        {"clave":"d43","descripcion":"INSTRUCTOR NA-D01","sm":235.84},
        {"clave":"d44","descripcion":"INSTRUCTOR NA-D02","sm":251.33},
        {"clave":"d45","descripcion":"INSTRUCTOR NA-D03","sm":258.89},
        {"clave":"d46","descripcion":"INSTRUCTOR NA-D04","sm":275.4},
        {"clave":"d47","descripcion":"INSTRUCTOR NA-D05","sm":313.45},
        {"clave":"d48","descripcion":"INSTRUCTOR NA-D06","sm":317.13},
        {"clave":"d49","descripcion":"INSTRUCTOR NA-D07","sm":333.01},
        {"clave":"d451","descripcion":"INSTRUCTOR NA-D09","sm":378.09},
        {"clave":"d453","descripcion":"INSTRUCTOR NA-D11","sm":427.05},
        {"clave":"AMB","descripcion":"MANUAL B","sm":4428.64},
        {"clave":"AMC","descripcion":"MANUAL C","sm":5133.23},
        {"clave":"ATA","descripcion":"TECNICO A","sm":5441.22},
        {"clave":"ATB","descripcion":"TECNICO B","sm":6469.88},
        {"clave":"ATC","descripcion":"TECNICO C","sm":7498.54},
        {"clave":"ATD","descripcion":"TECNICO D","sm":7598.96},
        {"clave":"A79","descripcion":"CABO DE OBRA","sm":11766.11},
        {"clave":"AAA","descripcion":"ADMINISTRATIVO F","sm":8247.37},
        {"clave":"AA2","descripcion":"ADMINISTRATIVO E","sm":8254.17},
        {"clave":"AAB","descripcion":"ADMINISTRATIVO D","sm":9805.44},
        {"clave":"AAC","descripcion":"ADMINISTRATIVO C","sm":11363.53},
        {"clave":"AAD","descripcion":"ADMINISTRATIVO B","sm":13268.71},
        {"clave":"A01","descripcion":"ADMINISTRATIVO A","sm":15586.48}
]

function calcularEdad(inputFecha) {
    // const inputFecha = document.getElementById("fechaNacimiento").value;
    const fechaNacimiento = new Date(inputFecha);
    const fechaActual = new Date();

    let edad = fechaActual.getFullYear() - fechaNacimiento.getFullYear();
    const mes = fechaActual.getMonth() - fechaNacimiento.getMonth();

    if (mes < 0 || (mes === 0 && fechaActual.getDate() < fechaNacimiento.getDate())) {
        edad--;
    }
    console.log(`(51)Tu edad laboral es: ${edad}`)
    return edad
}

const calculoG1=(datosEmpleado)=>{
    if(datosEmpleado.edadLaboral>=25 && datosEmpleado.edad>=50){
        Swal.fire({
            title: "Generación 1!",
            text: "Usted cumple con la edad tendra jubilación al 100%!",
            icon: "success"
        });
    }else{
        Swal.fire({
            title: "Generación 1!",
            text: "No cumple con la edad, Calculando jubilación?",
            icon: "question"
        });

    }
    return 0
}
const calculoG2=(datosEmpleado)=>{
    //
    let msg=""
    if(datosEmpleado.edad>=65 && datosEmpleado.edadLaboral>=15){
        msg="Jubilacion 100% retiro forzoso"
        Swal.fire({
                title: "Generación 2!",
                text: msg,
                icon: "question"
            });
    }else{
        Swal.fire({
                title: "Generación 2!",
                text: "No cumple la edad, Calcular pensión?",
                icon: "question"
            });
    }
    return 0
}
document.getElementById("formulario").addEventListener("submit", function(event) {
    event.preventDefault()
    let datosEmpleado={
        numEmp:0,
        nombre:"",
        nss:0,
        plaza:"",
        fechaIngreso:"",
        fechaAltaImss:"",
        edadLaboral:0,
        generacion:0,
        modalidad:0
    }
    const ssn = document.getElementById("nss").value;
    const ssnRegex = /^[0-9]{11}$/;
    const test=ssnRegex.test(ssn)
    console.log("Test:",test)
    if (!test) {
        //document.getElementById("mensaje-error").style.display = "none"; // Ocultar mensaje de error
        alert("Número de Seguro Social inválido");
        return
    }
    //document.getElementById("mensaje-error").style.display = "block"; // Mostrar mensaje de error
    
    //filtrar el año de afiliación del trabajador
    const tmp = ssn.substring(2, 4);
    const anioAltaImss = tmp>50? "19" + tmp: "20" + tmp
    // console.log("alta imss:",anioAltaImss)
    //cargar datos del empleado
    datosEmpleado.numEmp=document.getElementById("numEmp").value
    datosEmpleado.nombre=document.getElementById("nombre").value
    datosEmpleado.nss=document.getElementById("nss").value
    datosEmpleado.plaza=document.getElementById("tabulador").value
    // console.log("fecha de ingreso en html:",document.getElementById("ingreso").value)
    datosEmpleado.fechaIngreso=document.getElementById("ingreso").value
    const mes=document.getElementById("mesIngresoIMSS").value
    const dia=document.getElementById("diaIngresoIMSS").value
    const cadfecha=anioAltaImss+"-"+mes+"-"+dia
    datosEmpleado.fechaAltaImss=new Date(cadfecha)
    const fechaLimite=new Date("1997-06-30") //>30/06/97 es genaracion 2
    // if(datosEmpleado.fechaAltaImss>fechaLimite){
    //     datosEmpleado.modalidad=97
    // }else{
    //     datosEmpleado.modalidad=73
    // }
    datosEmpleado.modalidad = (datosEmpleado.fechaAltaImss>fechaLimite) ? 97 : 73
    datosEmpleado.generacion = 
        (new Date(datosEmpleado.fechaIngreso) > new Date("2023-09-18")) ? 2 : 1
    datosEmpleado.edad=document.getElementById("edad").value
    const edadLaboral = calcularEdad(datosEmpleado.fechaIngreso)
    datosEmpleado.edadLaboral=edadLaboral
    console.log("Datos json:",JSON.stringify(datosEmpleado))
    
    if(datosEmpleado.generacion==1){
        calculoG1(datosEmpleado)
    }else{
        calculoG2(datosEmpleado)
    }
})

window.onload=function(){
    const combo=document.getElementById("tabulador")
    tabuladorVigente.forEach(item=>{
        const opcion=document.createElement("option");
        opcion.value=item.clave
        opcion.textContent=item.descripcion
        combo.appendChild(opcion)
    })
}
</script>